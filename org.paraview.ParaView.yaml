app-id: org.paraview.ParaView
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: 5.15-21.08
base: io.qt.qtwebengine.BaseApp
base-version: 5.15-21.08
rename-icon: paraview
command: paraview
finish-args:
  - --share=ipc
  - --socket=x11
  - --device=dri
  - --share=network
  - --filesystem=home
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/doc
  - /share/man
  - /etc
  - '*.la'
  - '*.a'

# Disable ARM support, ParaView does not support it anyway.
modules:
  - shared-modules/glew/glew.json

  - name: python3-packaging
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/df/9e/d1a7217f69310c1db8fdf8ab396229f55a699ce34a203691794c5d1cad0c/packaging-21.3.tar.gz
        sha256: dd47c42927d89ab911e606518907cc2d3a1f38bbd026385970643f9c5b8ecfeb
        x-checker-data:
          type: pypi
          name: packaging
      #- type: patch
        #path: relax-dependencies.patch

  - name: python-pyparsing
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/71/22/207523d16464c40a0310d2d4d8926daffa00ac1f5b1576170a32db749636/pyparsing-3.0.9.tar.gz
        sha256: 2b020ecf7d21b687f219b71ecad3631f644a47f01403fa1d1036b0c6416d70fb
        x-checker-data:
          type: pypi
          name: pyparsing

  - name: python-numpy
    buildsystem: simple
    build-commands:
      - rm pyproject.toml
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/0a/88/f4f0c7a982efdf7bf22f283acf6009b29a9cc5835b684a49f8d3a4adb22f/numpy-1.23.3.tar.gz
        sha256: 51bf49c0cd1d52be0a240aa66f3458afc4b95d8993d2d04f0d91fa60c10af6cd
        x-checker-data:
          type: pypi
          name: numpy

  - name: python-certifi
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/cb/a4/7de7cd59e429bd0ee6521ba58a75adaec136d32f91a761b28a11d8088d44/certifi-2022.9.24.tar.gz
        sha256: 0d9c601124e5a6ba9712dbc60d9c53c21e34f5f641fe83002317394311bdce14
        x-checker-data:
          type: pypi
          name: certifi

  - name: qhull
    buildsystem: cmake
    sources:
      - type: archive
        url: http://www.qhull.org/download/qhull-2020-src-8.0.2.tgz
        sha256: b5c2d7eb833278881b952c8a52d20179eab87766b00b865000469a45c1838b7e
      #- type: patch
        #path: 0001-Link-executables-against-shared-libs.patch

  - name: python-setuptools-scm
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/d0/43/f038b5009f93bcd77b1b8da9e6d424b739ab17aec9726f3a99eba23d53ca/setuptools_scm-7.0.5.tar.gz
        sha256: 031e13af771d6f892b941adb6ea04545bbf91ebc5ce68c78aaf3fff6e1fb4844
        x-checker-data:
          type: pypi
          name: setuptools-scm

  - name: python-flit-core
    buildsystem: simple
    build-commands:
      - pip3 install . --prefix=/app --no-index --find-links .
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/15/d1/d8798b83e953fd6f86ca9b50f93eec464a9305b0661469c8234e61095481/flit_core-3.7.1.tar.gz
        sha256: 14955af340c43035dbfa96b5ee47407e377ee337f69e70f73064940d27d0a44f
        x-checker-data:
          type: pypi
          name: flit_core

  - python3-tomli.json

  - name: python-setuptools-scm-git-archive
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/69/5f/7135eec07395c51d3dd6899251b277405ecc2f8f7a80ef80a483e3c5a2bd/setuptools_scm_git_archive-1.4.tar.gz
        sha256: b048b27b32e1e76ec865b0caa4bb85df6ddbf4697d6909f567ac36709f6ef2f0
        x-checker-data:
          type: pypi
          name: setuptools-scm-git-archive

  - name: python3-toml
    buildsystem: simple
    ensure-writable:
      - /lib/python3.8/site-packages/easy-install.pth
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/be/ba/1f744cdc819428fc6b5084ec34d9b30660f6f9daaf70eead706e3203ec3c/toml-0.10.2.tar.gz
        sha256: b3bda1d108d5dd99f4a20d24d9c348e91c4db7ab1b749200bded2f839ccbe68f
        x-checker-data:
          type: pypi
          name: toml

  - name: python-matplotlib
    buildsystem: simple
    build-options:
      env:
        MPLSETUPCFG: /run/build/python-matplotlib/matplotlib-setup.cfg
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: file
        path: matplotlib-setup.cfg
      - type: archive
        url: https://files.pythonhosted.org/packages/0f/23/2eed6f40e1afca9c272fa7c13b437b7784c94a0c180f796c0da114265bf9/matplotlib-3.6.1.tar.gz
        sha256: e2d1b7225666f7e1bcc94c0bc9c587a82e3e8691da4757e357e5c2515222ee37
        x-checker-data:
          type: pypi
          name: matplotlib

  - name: python-cycler
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/34/45/a7caaacbfc2fa60bee42effc4bcc7d7c6dbe9c349500e04f65a861c15eb9/cycler-0.11.0.tar.gz
        sha256: 9c87405839a19696e837b3b818fed3f5f69f16f1eec1a1ad77e043dcea9c772f
        x-checker-data:
          type: pypi
          name: cycler

  - name: python-cppy
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/c5/7e/6cc5acd93752ee52d2f0423046072a2ce3ae16dfcd44373b9fe2a0222204/cppy-1.2.1.tar.gz
        sha256: 83b43bf17b1085ac15c5debdb42154f138b928234b21447358981f69d0d6fe1b
        x-checker-data:
          type: pypi
          name: cppy

  - name: python-kiwisolver
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/5f/5c/272a7dd49a1914f35cd8d6d9f386defa8b047f6fbd06badd6b77b3ba24e7/kiwisolver-1.4.4.tar.gz
        sha256: d41997519fcba4a1e46eb4a2fe31bc12f0ff957b2b81bac28db24744f333e955
        x-checker-data:
          type: pypi
          name: kiwisolver

  - name: python-setuptools_scm
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/d0/43/f038b5009f93bcd77b1b8da9e6d424b739ab17aec9726f3a99eba23d53ca/setuptools_scm-7.0.5.tar.gz
        sha256: 031e13af771d6f892b941adb6ea04545bbf91ebc5ce68c78aaf3fff6e1fb4844
        x-checker-data:
          type: pypi
          name: setuptools_scm

  - name: python-dateutil
    buildsystem: simple
    build-commands:
      - python3 setup.py install --prefix=${FLATPAK_DEST} --root=/ --optimize=1
    sources:
      - type: archive
        url: https://files.pythonhosted.org/packages/4c/c4/13b4776ea2d76c115c1d1b84579f3764ee6d57204f6be27119f13a61d0a9/python-dateutil-2.8.2.tar.gz
        sha256: 0123cacc1627ae19ddf3c27a5de5bd67ee4586fbdd6440d9748f8abb483d3e86
        x-checker-data:
          type: pypi
          name: python-dateutil

  - name: Boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix=/app
      - ./b2 install cxxflags="$CXXFLAGS" linkflags="$LDFLAGS" -j $FLATPAK_BUILDER_N_JOBS
    sources:
      - type: archive
        url: https://boostorg.jfrog.io/artifactory/main/release/1.80.0/source/boost_1_80_0.tar.bz2
        sha256: 1e19565d82e43bc59209a168f5ac899d3ba471d55c7610c677d4ccf2c9c500c0
        x-checker-data:
          type: anitya
          project-id: 6845
          stable-only: true
          url-template: https://boostorg.jfrog.io/artifactory/main/release/${version}/source/boost_${major}_${minor}_${patch}.tar.bz2

  - name: hdf5
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_TESTING:BOOL=OFF
      - -DHDF5_BUILD_EXAMPLES:BOOL=OFF
      - -DHDF5_ENABLE_Z_LIB_SUPPORT:BOOL=ON
    sources:
      - type: archive
        url: https://github.com/HDFGroup/hdf5/archive/refs/tags/hdf5-1_13_2.tar.gz
        sha256: 6b97168ce262d7f9fa67355171e8e1899989046bf70ca5735341b0872760af9a
        x-checker-data:
          type: anitya
          project-id: 1303
          stable-only: true
          url-template: https://github.com/HDFGroup/hdf5/archive/refs/tags/hdf5-${version}.tar.gz

  - name: netcdf
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    sources:
      - type: archive
        url: https://github.com/Unidata/netcdf-c/archive/v4.9.0.tar.gz
        sha256: 9f4cb864f3ab54adb75409984c6202323d2fc66c003e5308f3cdf224ed41c0a6
        x-checker-data:
          type: anitya
          project-id: 10354
          stable-only: true
          url-template: https://github.com/Unidata/netcdf-c/archive/v${version}.tar.gz

  - name: openmpi
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    sources:
      - type: archive
        url: https://download.open-mpi.org/release/open-mpi/v4.1/openmpi-4.1.4.tar.bz2
        sha256: 92912e175fd1234368c8730c03f4996fe5942e7479bb1d10059405e7f2b3930d
        x-checker-data:
          type: anitya
          project-id: 2554
          stable-only: true
          url-template: https://download.open-mpi.org/release/open-mpi/v${major}.${minor}/openmpi-${version}.tar.bz2

    # Use old version for now. https://gitlab.kitware.com/vtk/vtk/-/issues/18107
  - name: TBB
    buildsystem: cmake
    builddir: true
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    sources:
      - type: archive
        url: https://github.com/oneapi-src/oneTBB/archive/2019_U8.tar.gz
        sha256: 6b540118cbc79f9cbc06a35033c18156c21b84ab7b6cf56d773b168ad2b68566
      - type: patch
        path: tbb_cmake.patch

  - name: Embree
    buildsystem: cmake-ninja
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    config-opts:
      - -DEMBREE_TUTORIALS:BOOL=OFF
      - -DEMBREE_ISPC_SUPPORT:BOOL=ON
    sources:
      - type: archive
        url: https://github.com/embree/embree/archive/refs/tags/v3.13.1.tar.gz
        sha256: 00dbd852f19ae2b95f5106dd055ca4b304486436ced0ccf842aec4e38a4df425
    modules:
      - name: extra-cmake-modules
        buildsystem: cmake-ninja
        sources:
          - type: git
            url: https://invent.kde.org/frameworks/extra-cmake-modules.git
            tag: v5.9.0
        # Attempt to build from source, but ISPC need glic-32bit which make things complicated.
        # OSPRay need ISPC 1.9.2.
      - name: ISPC
        buildsystem: simple
        build-commands:
          - cp bin/ispc /app/bin/
        sources:
          - type: archive
            url: https://github.com/ispc/ispc/releases/download/v1.16.0/ispc-v1.16.0-linux.tar.gz
            sha256: 71a20e75ee1b952d8096a842368244111a0a727454d4a42043de10eadf02e740
      - name: glfw
        buildsystem: cmake-ninja
        config-opts:
          - -DGLFW_USE_WAYLAND:BOOL=ON
          - -DBUILD_SHARED_LIBS:BOOL=ON
          - -DGLFW_BUILD_EXAMPLES:BOOL=OFF
          - -DGLFW_BUILD_TESTS:BOOL=OFF
          - -DGLFW_BUILD_DOCS:BOOL=OFF
        sources:
          - type: archive
            url: https://github.com/glfw/glfw/releases/download/3.3.4/glfw-3.3.4.zip
            sha256: bbd2c42c660b725e9755eb417e40b373f0d4c03138c9b2e210d02cd308bd99cd

  - name: OSPRay
    buildsystem: cmake
    builddir: true
    config-opts:
      - -DOSPRAY_ENABLE_APPS_BENCHMARK:BOOL=OFF
      - -DOSPRAY_ENABLE_APPS_EXAMPLES:BOOL=OFF
      - -DOSPRAY_ENABLE_APPS_TUTORIALS:BOOL=OFF
      - -DOSPRAY_ENABLE_APPS_TESTING:BOOL=OFF
    sources:
      - type: archive
        url: https://github.com/ospray/ospray/archive/refs/tags/v2.9.0.tar.gz
        sha256: 0145e09c3618fb8152a32d5f5cff819eb065d90975ee4e35400d2db9eb9f6398
    modules:
      - name: rkcommon
        buildsystem: cmake
        builddir: true
        config-opts:
          - -DBUILD_TESTING:BOOL=OFF
        sources:
          - type: archive
            url: https://github.com/ospray/rkcommon/archive/refs/tags/v1.9.0.tar.gz
            sha256: b68aa02ef44c9e35c168f826a14802bb5cc6a9d769ba4b64b2c54f347a14aa53
      - name: openvkl
        buildsystem: cmake
        builddir: true
        config-opts:
          - -DBUILD_EXAMPLES:BOOL=OFF
          - -DBUILD_BENCHMARKS:BOOL=OFF
          - -DBUILD_TESTING:BOOL=OFF
        sources:
          - type: archive
            url: https://github.com/openvkl/openvkl/archive/refs/tags/v1.2.0.tar.gz
            sha256: dc468c2f0a359aaa946e04a01c2a6634081f7b6ce31b3c212c74bf7b4b0c9ec2

  - name: GDAL
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    sources:
      - type: archive
        url: https://download.osgeo.org/gdal/3.3.0/gdal-3.3.0.tar.gz
        sha256: 39fce17f8f421f4f81e3358b9cac21921355a344e20917ac6bd27d483f27e5c9
    modules:
      - name: PROJ
        buildsystem: cmake-ninja
        build-options:
          cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables
            -fasynchronous-unwind-tables -fstack-clash-protection -flto -fno-fat-lto-objects
          cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables
            -fasynchronous-unwind-tables -fstack-clash-protection -flto -fno-fat-lto-objects
        config-opts:
          - -DBUILD_TESTING:BOOL=OFF
        sources:
          - type: archive
            url: https://github.com/OSGeo/PROJ/releases/download/8.0.1/proj-8.0.1.tar.gz
            sha256: e0463a8068898785ca75dd49a261d3d28b07d0a88f3b657e8e0089e16a0375fa

  - name: GeoTIFF
    builddir: true
    build-options:
      cflags: -flto -ffat-lto-objects
      cxxflags: -flto -ffat-lto-objects
    sources:
      - type: archive
        url: https://download.osgeo.org/geotiff/libgeotiff/libgeotiff-1.6.0.tar.gz
        sha256: 9311017e5284cffb86f2c7b7a9df1fb5ebcdc61c30468fb2e6bca36e4272ebca

  - name: PDAL
    buildsystem: cmake
    builddir: true
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -ffat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -ffat-lto-objects
    config-opts:
      - -DWITH_TESTS=OFF
    sources:
      - type: archive
        url: https://github.com/PDAL/PDAL/releases/download/2.3.0/PDAL-2.3.0-src.tar.bz2
        sha256: 63d8d4fee491675f0fa3dca58c26d57fb2afcaa37c24b10f595b3fbff174996e

  - name: ADIOS2
    buildsystem: cmake-ninja
    builddir: true
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection
    config-opts:
      - -DADIOS2_RUN_INSTALL_TEST:BOOL=OFF
    sources:
      - type: archive
        url: https://github.com/ornladios/ADIOS2/archive/refs/tags/v2.8.3.tar.gz
        sha256: 4906ab1899721c41dd918dddb039ba2848a1fb0cf84f3a563a1179b9d6ee0d9f
        x-checker-data:
          type: anitya
          project-id: 220828
          stable-only: true
          url-template: https://github.com/ornladios/ADIOS2/archive/refs/tags/v${version}.tar.gz

  - name: lapack
    buildsystem: cmake-ninja
    builddir: true
    #build-options:
      #cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables -fstack-clash-protection -flto -fno-fat-lto-objects
      #cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables -fstack-clash-protection -flto -fno-fat-lto-objects
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_SHARED_LIBS=ON
      - -DBUILD_TESTING=OFF
      - -DLAPACKE=ON
      - -DCBLAS=ON
    sources:
      - type: archive
        url: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v3.10.1.tar.gz
        sha256: cd005cd021f144d7d5f7f33c943942db9f03a28d110d6a3b80d718a295f7f714
        x-checker-data:
          type: anitya
          project-id: 1534
          stable-only: true
          url-template: https://github.com/Reference-LAPACK/lapack/archive/refs/tags/v${version}.tar.gz

  - name: Eigen3
    buildsystem: cmake-ninja
    builddir: true
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    sources:
      - type: archive
        url: https://gitlab.com/libeigen/eigen/-/archive/3.4.0/eigen-3.4.0.tar.bz2
        sha256: b4c198460eba6f28d34894e3a5710998818515104d6e74e5cc331ce31e46e626
        x-checker-data:
          type: anitya
          project-id: 13751
          stable-only: true
          url-template: https://gitlab.com/libeigen/eigen/-/archive/${version}/eigen-${version}.tar.bz2
    cleanup:
      - '*'

  #- name: SWIG
    #sources:
      #- type: archive
        #url: https://sourceforge.net/projects/swig/files/swig/swig-4.0.2/swig-4.0.2.tar.gz
        #sha256: d53be9730d8d58a16bf0cbd1f8ac0c0c3e1090573168bfa151b01eb47fa906fc

  - name: OpenTURNS
    buildsystem: cmake-ninja
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    sources:
      - type: archive
        url: https://github.com/openturns/openturns/archive/refs/tags/v1.19.tar.gz
        sha256: 1d61cb6ce8ec1121db9f1e9fb490aaa056d2ff250db26df05d2e3e30ceb32344
        x-checker-data:
          type: anitya
          project-id: 220847
          stable-only: true
          url-template: https://github.com/openturns/openturns/archive/refs/tags/v${version}.tar.gz
    cleanup:
      - /share

    # Provide libnuma for MEMKIND
  - name: numactl
    build-options:
      cflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
      cxxflags: -O2 -D_FORTIFY_SOURCE=2 -fstack-protector-strong -funwind-tables -fasynchronous-unwind-tables
        -fstack-clash-protection -flto -fno-fat-lto-objects
    sources:
      - type: archive
        url: https://github.com/numactl/numactl/releases/download/v2.0.16/numactl-2.0.16.tar.gz
        sha256: 1b242f893af977a1d31af6ce9d6b8dafdd2d8ec3dc9207f7c2dc0d3446e7c7c8
        x-checker-data:
          type: anitya
          project-id: 2507
          stable-only: true
          url-template: https://github.com/numactl/numactl/releases/download/v${version}/numactl-${version}.tar.gz

  - name: MEMKIND
    build-options:
      cflags: -flto -ffat-lto-objects
      cxxflags: -flto -ffat-lto-objects
    sources:
      - type: archive
        url: https://github.com/memkind/memkind/archive/refs/tags/v1.13.0.tar.gz
        sha256: 3f0d919b61fdd4d2ebce14e0b7dbb856e2144138778940107c13549523f3bdc0
        x-checker-data:
          type: anitya
          project-id: 220852
          stable-only: true
          url-template: https://github.com/memkind/memkind/archive/refs/tags/v${version}.tar.gz

    # Have permission to distribute this.
    # https://discourse.paraview.org/t/holoplaycore-is-propreitary-software/7295
  #- name: HoloPlayCore
    #buildsystem: simple
    #build-commands:
      #- cp -r HoloPlayCore/include/* /app/include
      #- cp -r HoloPlayCore/dylib/linux/* /app/lib
    #sources:
      #- type: archive
        #url: https://www.paraview.org/files/dependencies/HoloPlayCore-0.1.1-Open-20200923.tar.gz
        #sha256: 8626082ddc89dbbd018e6113e069eb64c9f8e540db06c4c7e85162dc38b5ddad

    # liblas require many patch, so just use master until new version come out.
  - name: libLAS
    buildsystem: cmake-ninja
    config-opts:
      - -DWITH_TESTS=OFF
    sources:
      - type: git
        url: https://github.com/libLAS/libLAS.git
        commit: ded463732db1f9baf461be6f3fe5b8bb683c41cd

    # Paraview need 32GB of memory to build
  - name: Paraview
    buildsystem: cmake
    builddir: true
    build-options:
      cflags: -flto -ffat-lto-objects
      cxxflags: -flto -ffat-lto-objects
    config-opts:
      - -DCMAKE_BUILD_TYPE:STRING=Release
      - -DBUILD_TESTING:BOOL=OFF
      - -DPARAVIEW_USE_QT:BOOL=ON
      - -DPARAVIEW_USE_QTHELP:BOOL=ON
      - -DPARAVIEW_USE_QTWEBENGINE:BOOL=ON
      - -DPARAVIEW_USE_PYTHON:BOOL=ON
      - -DPARAVIEW_ENABLE_WEB:BOOL=ON
      - -DPARAVIEW_ENABLE_EMBEDDED_DOCUMENTATION:BOOL=ON
      - -DVTK_PYTHON_OPTIONAL_LINK:BOOL=OFF
      - -DVTK_OPENGL_HAS_OSMESA:BOOL=OFF
      - -DBUILD_EXAMPLES:BOOL=ON
      - -DPARAVIEW_PLUGINS_DEFAULT:BOOL=ON
      - -DVTK_SMP_IMPLEMENTATION_TYPE:STRING=TBB
      - -DVTK_PYTHON_VERSION:STRING=3
      - -DVTK_PYTHON_FULL_THREADSAFE:BOOL=ON
      - -DVTK_NO_PYTHON_THREADS:BOOL=OFF
      - -DQtTesting_INSTALL_NO_DEVELOPMENT:BOOL=ON
      - -DVTK_BUILD_QT_DESIGNER_PLUGIN:BOOL=OFF
      - -DPARAVIEW_INSTALL_DEVELOPMENT_FILES:BOOL=ON
      - -DPARAVIEW_BUILD_WITH_EXTERNAL:BOOL=OFF
      - -DPARAVIEW_ENABLE_FFMPEG:BOOL=ON
      - -DPARAVIEW_ENABLE_VISITBRIDGE:BOOL=ON
      - -DPARAVIEW_ENABLE_RAYTRACING:BOOL=ON
      - -DPARAVIEW_USE_MPI:BOOL=ON
      #- -DPARAVIEW_USE_CUDA:BOOL=ON
      - -DHDF5_ENABLE_OPTIMIZATION:BOOL=ON
      - -DPARAVIEW_ENABLE_XDMF2:BOOL=ON
      - -DPARAVIEW_ENABLE_XDMF3:BOOL=ON
      - -DPARAVIEW_ENABLE_ADIOS2:BOOL=ON
      - -DPARAVIEW_ENABLE_FIDES:BOOL=ON
      - -DPARAVIEW_ENABLE_FFMPEG:BOOL=ON
      - -DPARAVIEW_ENABLE_GDAL:BOOL=ON
      - -DPARAVIEW_ENABLE_LAS:BOOL=ON
      - -DPARAVIEW_ENABLE_OPENTURNS:BOOL=ON
      - -DPARAVIEW_ENABLE_PDAL:BOOL=ON
      - -DPARAVIEW_ENABLE_MOTIONFX:BOOL=ON
      #- -DPARAVIEW_ENABLE_MOMENTINVARIANTS:BOOL=ON
      #- -DPARAVIEW_ENABLE_LOOKINGGLASS:BOOL=ON
      #- -DHoloPlayCore_INCLUDE_DIR:PATH=/app/include/HoloPlayCore.h
      #- -DHoloPlayCore_LIBRARY=/app/lib/libHoloPlayCore.so
      - -DPARAVIEW_USE_MEMKIND:BOOL=ON
      - -DPARAVIEW_USE_VTKM:BOOL=ON
    sources:
      - type: archive
        url: https://www.paraview.org/files/v5.10/ParaView-v5.10.1.tar.gz
        sha256: 59ca46a929a52d8abec107b72e19447cba3d8e64871b6fbc8e99b0f3b167db46
      - type: patch
        path: fix_appdata_file.patch
      #- type: patch
        #path: paraview-5.9.0-gcc11-include.patch #https://bugs.gentoo.org/788055
      - type: git
        url: https://github.com/Kitware/LookingGlassVTKModule
        commit: c1e0df4842f22929a50daa0fe580a6a3dd3f015a
        dest: VTK/Remote/RenderingLookingGlass
      - type: archive
        url: https://www.paraview.org/files/dependencies/HoloPlayCore-0.1.1-Open-20200923.tar.gz
        sha256: 8626082ddc89dbbd018e6113e069eb64c9f8e540db06c4c7e85162dc38b5ddad
        # Something wrong, flathub cannot fetch  the git repo.
      #- type: git
        #url: https://gitlab.kitware.com/vtk/MomentInvariants
        ## See commit at VTK/Remote
        #commit: 3fb4824d1f5e1f95917e67a3fb4b8a1546ddd4ae
        #dest: VTK/Remote/MomentInvariants

    # Don't know why using post-install on ParaView fail.
  - name: install-icon
    buildsystem: simple
    build-commands:
      - install -Dm644 pvIcon.svg ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/${FLATPAK_ID}.svg
      - desktop-file-edit --set-icon=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/${FLATPAK_ID}.desktop
    sources:
      - type: file
        path: pvIcon.svg
